# delayed-streamBuffers events from a stream until you are ready to handle them.## Installation``` bashnpm install delayed-stream```## UsageThe following example shows how to write a http echo server that delays itsresponse by 1000 ms.``` javascriptvar DelayedStream = require('delayed-stream');var http = require('http');http.createServer(function(req, res) {  var delayed = DelayedStream.create(req);  setTimeout(function() {    res.writeHead(200);    delayed.pipe(res);  }, 1000);});```If you are not using `Stream#pipe`, you can also manually release the bufferedevents by calling `delayedStream.resume()`:``` javascriptvar delayed = DelayedStream.create(req);setTimeout(function() {  // Emit all buffered events and resume underlaying source  delayed.resume();}, 1000);```## ImplementationIn order to use this meta stream properly, here are a few things you shouldknow about the implementation.### Event Buffering / ProxyingAll events of the `source` stream are hijacked by overwriting the `source.emit`method. Until node implements a catch-all event listener, this is the only way.However, delayed-stream still continues to emit all events it captures on the`source`, regardless of whether you have released the delayed stream yet ornot.Upon creation, delayed-stream captures all `source` events and stores them inan internal event buffer. Once `delayedStream.release()` is called, allbuffered events are emitted on the `delayedStream`, and the event buffer iscleared. After that, delayed-stream merely acts as a proxy for the underlayingsource.### Error handlingError events on `source` are buffered / proxied just like any other events.However, `delayedStream.create` attaches a no-op `'error'` listener to the`source`. This way you only have to handle errors on the `delayedStream`object, rather than in two places.### Buffer limitsdelayed-stream provides a `maxDataSize` property that can be used to limitthe amount of data being buffered. In order to protect you from bad `source`streams that don't react to `source.pause()`, this feature is enabled bydefault.## API### DelayedStream.create(source, [options])Returns a new `delayedStream`. Available options are:* `pauseStream`* `maxDataSize`The description for those properties can be found below.### delayedStream.sourceThe `source` stream managed by this object. This is useful if you arepassing your `delayedStream` around, and you still want to access propertieson the `source` object.### delayedStream.pauseStream = trueWhether to pause the underlaying `source` when calling`DelayedStream.create()`. Modifying this property afterwards has no effect.### delayedStream.maxDataSize = 1024 * 1024The amount of data to buffer before emitting an `error`.If the underlaying source is emitting `Buffer` objects, the `maxDataSize`refers to bytes.If the underlaying source is emitting JavaScript strings, the size refers tocharacters.If you know what you are doing, you can set this property to `Infinity` todisable this feature. You can also modify this property during runtime.### delayedStream.dataSize = 0The amount of data buffered so far.### delayedStream.readableAn ECMA5 getter that returns the value of `source.readable`.### delayedStream.resume()If the `delayedStream` has not been released so far, `delayedStream.release()`is called.In either case, `source.resume()` is called.### delayedStream.pause()Calls `source.pause()`.### delayedStream.pipe(dest)Calls `delayedStream.resume()` and then proxies the arguments to `source.pipe`.### delayedStream.release()Emits and clears all events that have been buffered up so far. This does notresume the underlaying source, use `delayedStream.resume()` instead.## Licensedelayed-stream is licensed under the MIT license.
